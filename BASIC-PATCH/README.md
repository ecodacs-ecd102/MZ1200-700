# MZ-700 S-BASIC 1Z-007B, 1Z-013B, HuBASICをMZ-80K_SD対応にするパッチ

　MZ-700のS-BASIC,Hu-BASICはモニタROMをコールせず、RAM上に独自のIOCSを持っていて、かつ、$D000～$FFFFをRAMバンクに切り替えてBASICのエリアとしているため、$F000からのROM内ルーチンが使えません。
　また、IOCSそのものも、ROM内の物とはエントリや仕様が微妙に異なるため、単にバンクを切り戻してROMをコールする、といった手法が使えません。

　従って、BASICが抱え込むIOCS部分そのものにパッチを当てて、直接MZ-80K_SDを制御するようにパッチを当てる必要がありました。

#### 2023.2.24 本来80K用の回路ですのでMZ-700でRAMバンクが前に出た時にROMの出力と衝突します。このパッチをS-BASICに使用する場合はMZ-700本体にストレスがかかることを承知の上使用してください。

## パッチプログラムについて

　SBASIC_patch1.bin、SBASIC_patch2.binの二つをS-BASICのMZTファイルに当てます。

　MZTファイルの00A1Hから00AFHまで(実アドレス0021H～002FH)をSBASIC_patch1.binと差し替えます。

　MZTファイルの5184Hから52E7Hまで(実アドレス5104H～5267H)をSBASIC_patch2.binと差し替えます。

　パッチを当てたファイルを「S-BASIC SD.MZT」等パッチを当てたことが識別できるファイル名で保存してお使いください。

　プロッタのCIRCLE命令をつぶしています。プロッタの他の命令に影響があるか検証していませんが、プロッタ関連の命令は使えないとしてください。

## ファイル名について

　オリジナル通りに16文字までがファイル名となりますが、半角カナ文字はArduinoが認識できない、一部の記号はMZ-700のキーボードから入力できないので使えません。

　ロングファイルネームに対応できなかった引き換えにLOADコマンドもオリジナル通りの入力方法となり、そのままDOSファイル名となります。

例)

　SAVE "TEST.BAS" : TEST.BAS.MZTというDOSファイル名で保存されます。

　SAVE "TEST"     : TEST.MZTというDOSファイル名で保存されます。

　LOAD "TEST.BAS" : TEST.BAS.MZTというDOSファイル名のファイルがロードされます。

　LOAD "TEST"     : TEST.MZTというDOSファイル名のファイルがロードされます。

　DOSファイル名が「TEST SBASIC EIGHT.MZT」の場合、LOAD "TEST SBASIC EIGHT"と入力しても「TEST SBASIC EIGH.MZT」というDOSファイルを探しに行くためロードできません。

## 使用方法
　パッチを当てたS-BASIC.MZTをFDコマンドでロードします。MONITOR 1Z-009A、1Z-009Bにパッチを当てる必要はありませんので、FT.MZTの実行も不要です。

## 追記
2021.12.26

　エラー処理のバグを修正。
